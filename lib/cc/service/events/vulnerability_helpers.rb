module CC::Service::VulnerabilityHelpers
  def new_issues_found(html = false)
    if html
      level = linked_warning_type
    else
      level = warning_type
    end

    if multiple?
      "#{vulnerabilities.size} new #{level} issues found"
    else
      "New #{level} issue found" << location_info
    end
  end

  def vulnerability
    vulnerabilities.first || {}
  end

  def vulnerabilities
    payload.fetch("vulnerabilities", [])
  end

  def multiple?
    vulnerabilities.size > 1
  end

  def location_info
    if vulnerability["location"]
      " in #{vulnerability["location"]}"
    else
      ""
    end
  end

  def warning_type
    if multiple?
      payload["warning_type"]
    else
      vulnerability["warning_type"]
    end
  end

  def linked_warning_type
    "<a href=\"#{details_url}\">#{warning_type}</a>"
  end

end
